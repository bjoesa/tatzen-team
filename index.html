<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tatzen Team App</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="grid.css">

    <style>

        .background-dark {
            background-color: #2a3cdb;
        }
        
        .center {
            display: flex;
            justify-content: center;
        }
        
        .margin-top {
            margin-top: 40px;
        }
        
        .timer {
            font-size: 60px;
            color: white;
            font-family: 'Roboto', sans-serif;
            cursor: not-allowed;
        }

        /* Button controls */

        .buttons {
            display: block;
        }

        .button {
            border: none;
            border-radius: 8px;
            color: black;
            font-family: 'Arial', sans-serif;
            text-transform: uppercase;
            min-width: 150px;
            padding: 15px;
            text-align: center;
            text-decoration: none;
            /* display: inline-block; */
            font-size: 20px;
            margin: 4px 2px;
            cursor: pointer;
        }

        .button-start {
            background-color: yellow;
        }

        .button-stop {
            background-color: lightcoral;
        }

        /* img manipulation */

        .blinker {
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0% {
                filter: brightness(100%), hue-rotate(180deg);
            }
            100% {
                filter: brightness(250%);
            }
        }

        .roterblinker {
            animation: rotblink 1s infinite;
        }

        @keyframes rotblink {
            0% {
                filter: brightness(100%), saturate(7);
            }
            100% {
                filter: brightness(150%);
            }
        }

        .tatze, .feuerwehr, .polizei {
            cursor: pointer;
        }

        #tatze:hover {
            opacity: .5;
            transform: scaleX(-1);
        }

    </style>

    <script>
        let alarm = new Audio('sounds/feuerwehr-sirene.mp3');
        let policealarm = new Audio('sounds/polizei-sirene.mp3');
        let timerStarted = false;


        function startTimer() {
            if (!timerStarted) {
                let startTime = new Date().getTime();
                let fiveMinutes = 1000 * 60 * 5;
                let endTime = startTime + fiveMinutes;


                var myInterval = setInterval(function() {
                    let timeLeft = endTime - new Date().getTime();


                    if (timeLeft > 0) {
                        let minutes = timeLeft / (1000 * 60);
                        minutes = Math.floor(minutes);
                        let seconds = (timeLeft / 1000) % 60;
                        seconds = Math.round(seconds);
                        seconds = ('0' + seconds).slice(-2);
                        let text = '0'  +  minutes  +  ' : '  +  seconds;
                        timer.innerHTML = text;
                        document.getElementById('blaulicht').className = 'blinker';
                        
                    } else {
                        alarm.play();
                        timer.innerHTML = '00 : 00';
                    }
                }, 1000);
                timerStarted = true;
            }
        }

        // Soundsteuerung
        // +++ TODO +++ insert sound loop
        function fireAlarm() {
            alarm.play();
            document.getElementById('blaulicht').className = 'roterblinker';
        }

        function policeAlarm() {
            policealarm.play();
            document.getElementById('blaulicht').className = 'blinker';
        }

        function sirenePause() {
            alarm.pause();
            policealarm.pause();
        }

        function sireneReset() {
            alarm.currentTime = 0;
            policealarm.currentTime = 0;
            alarm.pause();
            policealarm.pause();
        }

        // reset page to reset timer (workaround)
        function resetPage() {
            window.location.reload(true);
        }

    </script>

</head>

<body class="background-dark">

<!-- Grid -->

<div class="grid-container">
  <div class="item1">
      <img class="blaulicht" id="blaulicht" width="200" height="200" src="img/Blaulicht-state-dunkelblau.png">
  </div>

  <div class="item2 center">
    <div class="timer" id="timer">05 : 00</div>
  </div>

  <div class="item3">        
        <div class='buttons'>
            <button class='button button-stop' onclick="resetPage()">Einsatz beenden</button>
        </div>
        <div>
            <button class='button button-start' onclick="sirenePause()">Pause sound</button>
        </div>
        <div>
            <button class='button' onclick="sireneReset()">Stop sound</button>
        </div>
  </div>  
  
  <div class="item4">
    <img class="polizei" id="polizei" onclick="policeAlarm()" src="img/Polizeihund_mit_Schatten_mit-kreis.png">
  </div>

  <div class="item5">
    <img onclick="startTimer()" class="tatze" id="tatze" width="200" height="200" src="img/tatze.png">
  </div>
  
  <div class="item6">
    <img class="feuerwehr" id="feuerwehr" onclick="fireAlarm()" width="200" height="200" src="img/Feuerwehrhund_mit_Schatten_mit-kreis.png">
  </div>
</div>


</body>

</html>